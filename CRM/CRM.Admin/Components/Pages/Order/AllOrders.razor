@page "/allOrders"
@using CRM.Admin.Data.OrderDto

<MudGrid>
    <MudItem xs="4">
        <MudButton
            Variant="Variant.Filled"
            OnClick="CreateOrder"
            StartIcon="@Icons.Material.Filled.AddCircleOutline"
            Class="buttonBase">
            СТВОРИТИ
        </MudButton>
    </MudItem>
</MudGrid>
<MudTable ServerData="@(new Func<TableState, Task<TableData<OrderDto>>>(ServerReload))"
          Dense="true" Hover="true" @ref="_table">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Інформація по замовленню</MudText>
        <MudSpacer/>
        <MudTextField T="string" ValueChanged="@(s => OnSearch(s))" Placeholder="Search" Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
        </MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>
            <MudTableSortLabel SortLabel="Date" T="OrderDto">Дата створення</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="ClientName" T="OrderDto">Турист</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="CountryToName" T="OrderDto">Країна</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="Stays" T="OrderDto">Проживання</MudTableSortLabel>
        </MudTh>
        <MudTh>
            <MudTableSortLabel SortLabel="DateFrom" T="OrderDto">Дата</MudTableSortLabel>
        </MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Дата створення">@context.CreatedAt.ToShortDateString()</MudTd>
        <MudTd DataLabel="Турист">
            <MudLink Href=@($"orderById/{context.Id}") Underline="Underline.None" Color="Color.Dark" Typo="Typo.overline">
                @($"{context.ClientName}")
            </MudLink>
        </MudTd>
        <MudTd DataLabel="Країна">@context.CountryToName</MudTd>
        <MudTd DataLabel="Проживання">
            @foreach (var stay in context.Stays)
            {
                @stay.HotelName
            }
        </MudTd>
        <MudTd DataLabel="Дата"> з @context.DateFrom.ToShortDateString() до @context.DateTo.ToShortDateString()</MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>No matching records found</MudText>
    </NoRecordsContent>
    <LoadingContent>
        <MudText>Loading...</MudText>
    </LoadingContent>
    <PagerContent>
        <MudTablePager/>
    </PagerContent>
</MudTable>
